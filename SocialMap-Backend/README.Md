SocialMap API
=========

## Feactures
<ul>
<li>Autentifica√ß√£o com JWT e encriptografia de senha</li>
<li>Helmet - para prote√ß√£o</li>
<li>Swagger - Cria√ß√£o da documenta√ß√£o</li>
<li>Morgan - Cria√ß√£o de Logs para cada inicia√ß√£o do server</li>
<li>Websocket - Para alerta de notfica√ß√µes</li>
<li>RabbitMQ - Exchange para Notifica√ß√µes</li>
</ul>

# Mensageria
- Exchange do tipo 'direct' pra notifica√ß√µes
- Filas para cada tipo de notifica√ß√£o tratada
- A seguir um esquema do funcionamento:
<p align="center">
<img width="450" style="border-radius: 5px" height="400" src="../midias/rabbit.gif" alt="Intro">
</p>

# Requisitos
- Adicionar usu√°rio do Sysmap com a descri√ß√£o da empresa no inicio do feed

# Principais Personaliza√ß√µes

- Checagem do estado do container rabbitmq para iniciar o dependentes.
```sh
    healthcheck:
      test: [ "CMD", "nc", "-z", "http://localhost:15672" ]
      interval: 10s
      timeout: 5s
      retries: 5
```
- Popula√ß√£o robusta do banco de dados, atrav√©z do seed

- Post com midia e texto
- Usando a lib ampqlib para rabbitMQ
- Criando exchange e filas na inicializa√ß√£o do server
- Usando o addToSet em vez do push para evitar duplica√ß√£o de likes ou seguidores
```
{ $addToSet: { following: id_two }
```
- Populando apenas os campos desejados para economizar no tr√°fego de dados
```
.populate('profile', ['name', 'midia'])
.populate({ path: 'comments', populate: { path: 'profile', select: ['name' 'midia'] } })
```


        
# üé≤ Para Rodar o Back End

```shell
$ cd SocialMap-Backend
```

- No arquivo .env, mude o valor da vari√°vel HOTS para o host da sua rede

```js
HOST=SUA_REDE
```


### Inicie o container do Backend
* OBS: Cuidado com os poss√≠veis erros causados por nomes gen√©ricos nos containers como 'mongodb'. Voc√™ pode precisar renome√°-los.
```shell
$ docker-compose build
$ docker-compose up
```

- No arquivo app.js pode ser necess√°rio comentar a linha que invoca o middlware helmet.
```js
// Middlewares
app.use(cors())
//app.use(helmet());
```

- Para popular o banco de dados para fins de teste fa√ßa um get na rota a baixo, simplesmente colando esse endere√ßo no navegador. Com o backend rodando √© claro.
```sh
http://SUA_REDE:4000/v1/dev/seed
```
